<html>
<head>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<!-- Load the d3 library. -->
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<style>
/* put a border around the svg element so we can see the coordinate system better. */
body { font-family: "Open Sans"; } div { margin: 30px; }
svg { background-color: #f0f0f0; }
</style>
</head>
<body>

<h3> INTERNET USAGE STATISTICS UNITED STATES - State by State</h3>

<div>Data from <a href="http://www.internetworldstats.com/stats26.htm">United States of America
Internet and Facebook Users Stats</a>.</div>

<!-- The SVG element will go in here -->
<div id="map"></div>

<script>

var width = 960,
    height = 500;

var projection = d3.geo.albersUsa();
var path = d3.geo.path().projection(projection);
	
var svg = d3.select("#map").append("svg")
    .attr("width", width)
    .attr("height", height);

var states;
var populationScale = d3.scale.linear().domain([0.5 , 0.95]).range(["#f7fbff", "#551A8B"]);

d3.json("states.json", function(error, shapes) {
	if (error) throw error;
	states = topojson.feature(shapes, shapes.objects.states).features;
	console.log(states);

	d3.csv("iud.csv", function (error, rows) {
		if (error) throw error;
		console.log(rows); 

		m = d3.map(rows, function (row) { 
			// return row.Name;
			return Number(row.id); 
		});

		var statePaths = svg.append("g")
		.selectAll("path").data(states).enter()
		.append("path").attr("d", path)
		.style("fill",  function(state) {
			var stateData = m.get(state.id);
			if (stateData) {
				return populationScale(stateData.InternetPenetration);
				}
				else { 
					return "#D3D3D3"; 
				}
				return populationScale(m.get(state.id).InternetPenetration); 
			})
		.style("stroke", "#ccc");
	}); // end csv
}); // end json

</script>
</body>
</html>